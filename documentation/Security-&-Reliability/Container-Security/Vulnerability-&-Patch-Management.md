# Handling Vulnerabilities

Deployed container images will required updates to fix previously unknown security issues or software bugs.
An defense in depth approach consists of the following measures:

1. **Prevent** images w. known vulnerabilities from deployed
2. Regularly check for vulnerabilities in deployed container images
3. Act on newly found vulnerabilities/required updates


**Preventing** images w. known vulnerabilities from being deployed is handled by image scans in our pipelines, see [Image Scanning](/Security-&-Reliability/Container-Security) for details.

**Continuous** vulnerability scans are configured via [Azure Defender](https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-containers-vulnerability-assessment-azure). Running images are scanned every 7 days.

Several possibilities exist to deal w. new vulnerabilities:

- **Automatically fix** the issue by triggering an image rebuilt w. automatically update base images via [ACR tasks](https://learn.microsoft.com/en-us/azure/container-registry/container-registry-tasks-overview)
- **Notify** stakeholders about the issue

The first approach is, due to compliance reasons, not viable atm. as we would be responsible for ensuring that the application running in the container is unaffected by the update.
Therefore the solution is to notify stakeholders and demand actions.

## Severity Score based handling

A notification is triggered once a week that reports the vulnerabilities from the vulnerability assessments created by Azure Defender for a specific repository/image version.
Depending on the CVSS 3.1 score a different action is taken and the customer/stakeholder is given time to fix the issue.

Note: Zeiss Security is working on a specific policy (which we will adapt if suitable) an example could be:

| Score  | Time to action | Action                                           |
|--------|----------------|--------------------------------------------------|
| >= 9.0 | 2 days         | notify, turn off deployed containers immediately |
| >= 8.0 | 3 working days | notify                                           |
| >= 7.0 | 5 working days | notify                                           |
| <7.0   | 7 working days | notify                                           |


### Notification via LogicApp
The above notifications are implemented via logic app that accesses the [Azure Defender Vulnerability SubAssessments API](https://learn.microsoft.com/en-us/rest/api/defenderforcloud/sub-assessments/get?tabs=HTTP) to retrieve vulnerability assessment reports for specific container registries.

#### Example Notification Mail


```
9 vulnerabilities found in bsi:sha256:1e383b646aec3141c03dd15d18f292c324f894f9951c8682219fdc9ba4952203

Description	                                              Patchable	Score	Severity
Microsoft Windows Security Update for October 2022	        True	9.1	High
Microsoft .NET Security Update for March 2022	                True	8.8	Medium
Microsoft .NET (NuGet Client) Security Update for October 2022	True	7.8	High
Microsoft ASP.NET Core Security Update for December 2021	True	7.8	Medium
Microsoft .NET Security Update for September 2022	        True	7.5	High
Microsoft .NET Security Update for May 2022	                True	7.5	Medium
Microsoft .NET Security Update for August 2022	                True	5.9	Medium
Microsoft .NET Security Update for June 2022	                True	5.5	Medium
Allowed Null Session	                                        False	-1	Medium
```